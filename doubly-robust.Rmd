
```{r}
library(tidyverse)
set.seed(0)
```

```{r}
n = 100

# GENERATE IVs
z1 <- rnorm(n, mean = 0, sd = 1)
z2 <- rnorm(n, mean = 0, sd = 1)
z3 <- replicate(n, ifelse(rnorm(1, mean = 0, sd = 1) <= 0.3, 1, 0))

# GENERATE EXPOSURE AS A FUNCTION OF IVs

# Set betas
b0 = 1.5
b1 = 1
b2 = -2
b3 = 1

# Calculate true propensity scores (logit)
# TODO: Confirm R broadcasts b0 to correct length
ps <- (1 + exp(b0 + b1*z1 + b2*z2 + b3*z3))^(-1)

# Calculate exposure
x <- ifelse(ps + runif(n, min = 0, max = 1) < 0.91, 1, 0)

# GENERATE TRUE OUTCOMES
b4 <- 2
z4 <- rnorm(n, mean = 0, sd = 1)
y <- b1*z1 + b3*z3 + b4*z4

# TRUE DATA
data <- tibble(z1, z2, z3, x, ps, y)
treat <- data %>% filter(x == 1)
control <- data %>% filter(x == 0)
```

```{r}
# GENERATE ESTIMATED OUTCOMES
t = nrow(treat)
c = nrow(control)

# Scenario 1
ps1_t <- (1 + exp(b0 + b1*treat$z1 + b3*treat$z3))^(-1)
yhat1 <- b0 + b1*treat$z1 + b3*treat$z3
yhat0 <- 99 # ???
```



